// Prisma schema for Feedback Pulse

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User model for authentication
model User {
  id           String    @id @default(cuid())
  email        String    @unique
  passwordHash String?
  googleId     String?   @unique
  createdAt    DateTime  @default(now())
  projects     Project[]

  @@map("users")
}

// Project model - for multiple projects
model Project {
  id         String     @id @default(cuid())
  userId     String
  name       String
  projectKey String     @unique
  createdAt  DateTime   @default(now())
  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  feedback   Feedback[]

  @@index([userId])
  @@index([projectKey])
  @@map("projects")
}

// Feedback type enum
enum FeedbackType {
  Bug
  Feature
  Other
}

// Sentiment enum for AI analysis
enum Sentiment {
  positive
  neutral
  negative
}

// Feedback model - stores submissions
model Feedback {
  id        String        @id @default(cuid())
  projectId String
  type      FeedbackType
  message   String
  sentiment Sentiment?
  createdAt DateTime      @default(now())
  project   Project       @relation(fields: [projectId], references: [id], onDelete: Cascade)
  labels    FeedbackLabel[]

  @@index([projectId])
  @@index([type])
  @@index([createdAt])
  @@map("feedback")
}

// FeedbackLabel model - allows tagging feedback with labels
model FeedbackLabel {
  id         String   @id @default(cuid())
  feedbackId String
  label      String
  createdAt  DateTime @default(now())
  feedback   Feedback @relation(fields: [feedbackId], references: [id], onDelete: Cascade)

  @@index([feedbackId])
  @@map("feedback_labels")
}
