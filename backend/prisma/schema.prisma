generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String    @id @default(cuid())
  email        String    @unique
  passwordHash String?
  googleId     String?   @unique
  createdAt    DateTime  @default(now())
  projects     Project[]

  @@map("users")
}

model Project {
  id         String     @id @default(cuid())
  userId     String
  name       String
  projectKey String     @unique
  createdAt  DateTime   @default(now())
  feedback   Feedback[]
  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Widget customization fields
  widgetIcon       String   @default("chat")      // chat, mail, question, star, settings, thumbsUp, envelope, info
  widgetText       String   @default("Feedback")  // Launcher button text
  widgetPrimary    String   @default("#2563EB")   // Primary color
  widgetTextColor  String   @default("#FFFFFF")   // Text color
  widgetBackground String   @default("#FFFFFF")   // Background color
  widgetPosition   String   @default("bottom-right") // top-left, top-right, bottom-left, bottom-right

  // Domain restriction for widget
  allowedDomains   String?                        // Comma-separated list of allowed domains (e.g., "example.com,myapp.netlify.app")

  // Webhook configuration
  webhookUrl       String?                        // URL to send webhook POST requests
  webhookSecret    String?                        // Secret for HMAC-SHA256 signature verification
  webhookEnabled   Boolean  @default(false)       // Whether webhook is active

  @@index([userId])
  @@index([projectKey])
  @@map("projects")
}

model Feedback {
  id        String          @id @default(cuid())
  projectId String
  type      FeedbackType
  message   String
  sentiment Sentiment?
  createdAt DateTime        @default(now())
  project   Project         @relation(fields: [projectId], references: [id], onDelete: Cascade)
  labels    FeedbackLabel[]

  @@index([projectId])
  @@index([type])
  @@index([createdAt])
  @@map("feedback")
}

model FeedbackLabel {
  id         String   @id @default(cuid())
  feedbackId String
  label      String
  createdAt  DateTime @default(now())
  feedback   Feedback @relation(fields: [feedbackId], references: [id], onDelete: Cascade)

  @@index([feedbackId])
  @@map("feedback_labels")
}

enum FeedbackType {
  Bug
  Feature
  Other
}

enum Sentiment {
  positive
  neutral
  negative
}
